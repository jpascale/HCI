<!DOCTYPE html>
<html>
<head>
	<title>look&amp;feel</title>
		<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<meta charset="utf-8">
	<link rel="stylesheet" href="profile.css">
	<link rel="stylesheet" href="finalizar_compra.css">

<!-- ____________________________________________________ --><link href="sticky-footer-navbar.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">

  </head>

  <body>
    
    <header id="content-top">


      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a id="logo-box" class="navbar-brand verticalLine" href="index.html"><h1>look&amp;feel</h1></a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            
            <ul class="nav navbar-nav">
              <li id="women"><a id="women-link" href="#">Mujeres</a></li>
              <li id="men"><a id="men-link" href="#" class="verticalLine">Hombres</a></li>
              <li id="girls"><a id="girls-link" href="#">Niñas</a></li>
              <li id="boys" class="verticalLine"><a id="boys-link" href="#">Niños</a></li>
              <li id="babies"><a id="babies-link" href="#">Bebés</a></li>
            </ul>

            <form class="navbar-form navbar-left" role="search">
              <div class="form-group">
                <input id="search_key" type="text" class="form-control search-bar" placeholder="Buscar un producto">
              </div>
              <button id="search" type="button" class="btn btn-default">Ir</button>
            </form>
            
            <ul class="nav navbar-nav navbar-right">
              <li><a id="register" href="register.html">Registrarse</a></li>
              <li class="verticalLine"><a id="login" href="ingresar.html">Ingresar</a></li>
              <li><a id="cart-link" href="#"><img id="cart-img" src="img/cart.png" alt="carrito"></a></li>
              <li id="fav-li"><a id="fav-link" href="#"><img id="fav-img" src="img/fav.png" alt="favoritos"></a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
  </header>

<!-- ___________________________________________ -->
    
	<div class="container">
		<div class="row">&nbsp;</div>
		<div class="row">&nbsp;</div>
		<div class="row">&nbsp;</div>
		<div class="row">&nbsp;</div>
		<div class="row">&nbsp;</div>
	</div>

	<div class="container">
		<!-- ___________________________________________ -->
	    <noscript>
	      <div class="alert alert-danger" role="alert">
	       <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
	       <span class="sr-only">Error:</span>
	        Es necesario activar JavaScript para que la web funcione correctamente.
	      </div>
	    </noscript>
	    <!-- End no js msg -->
	    <!-- ___________________________________________ -->
		<div class = "row spaced">
				<div class = "col-xs-6">
					<h2 class="page-title"> Modificar Datos Personales</h2>
				</div>
		</div>
		<div class="row">
			<div class="col-xs-6 datos_de_cuenta thumbnail">
          		<div class="row textList">
					<div class="col-xs-4">
						<p class="question2">Nombre:<span class="rojito">*</span></p>
					</div>
					<div class="col-xs-8">
						<p><input class="form-control pull-right" id="fname" type="text" name="Nombre" value=""></p>
					</div>
				</div>
				<div class="col-xs-12 collapse" id="collapse_fname">
						<p class="rojito">El nombre no es válido</p>
				</div>
				<div class="row textList">
					<div class="col-xs-4">
						<p class="question2">Apellido:<span class="rojito">*</span></p>
					</div>
					<div class="col-xs-8">
						<p><input class="form-control pull-right" id="lname" type="text" name="Nombre" value=""></p>
					</div>
				</div>
				<div class="col-xs-12 collapse" id="collapse_lname">
						<p class="rojito">El apellido no es válido</p>
				</div>
				<div class="row textList">
					<div class="col-md-4">
						<p class="question2">Fecha de Nacimiento:<span class="rojito">*</span></p>
					</div>
					<div class="col-md-7" >
						<div class="row">
							<div class="col-xs-4 col-md-4">
								<div class="dropdown">
	  								<button class="btn btn-md dropdown-toggle btn-default" id="default_day" type="button" data-toggle="dropdown">Día
	 								<span class="caret"></span></button>
	 								<ul id="DAYS" class="dropdown-menu listElem">
										
									</ul>
								</div>
							</div>
							<div class="col-xs-4 col-md-4">
								<div class="dropdown">
	  								<button id="default_month" class="btn btn-md dropdown-toggle btn-default" type="button" data-toggle="dropdown">Mes
	 								<span class="caret"></span></button>
	 								<ul id="MONTH" class="dropdown-menu listElem">
										<li><a class="month1">Enero</a></li>
										<li><a class="month3">Febrero</a></li>
										<li><a class="month1">Marzo</a></li>
										<li><a class="month2">Abril</a></li>
										<li><a class="month1">Mayo</a></li>
										<li><a class="month2">Junio</a></li>
										<li><a class="month1">Julio</a></li>
										<li><a class="month1">Agosto</a></li>
										<li><a class="month2">Septiembre</a></li>
										<li><a class="month1">Octubre</a></li>
										<li><a class="month2">Noviembre</a></li>
										<li><a class="month1">Diciembre</a></li>
									</ul>
								</div>
							</div>
							<div class="col-xs-4 col-md-4">
								<div class="dropdown">
	  								<button class="btn btn-md dropdown-toggle btn-default" id="default_year" type="button" data-toggle="dropdown">Año
	 								<span class="caret"></span></button>
	 								<ul id="YEARS" class="dropdown-menu listElem">
										
									</ul>
								</div>
							</div>
						</div>	
					</div>
				</div>


				<!--<div class="row textList">
					<div class="col-xs-4">
						<p class="question2">Fecha de Nacimiento:<span class="rojito">*</span></p>
					</div>
					<div class="col-xs-8">
						<p><input class="form-control pull-right" id="personales3" type="text" name="Nombre" value=""></p>
					</div>
				</div>
				-->
				<!--
				<div class="row textList">
					<div class="col-xs-4">
						<p class="question2">Género:<span class="rojito">*</span></p>
					</div>
					<div class="col-xs-8">
						<p><input class="form-control pull-right" id="gender" type="text" name="Nombre" value=""></p>
					</div>
				</div>
				<div class="col-xs-12 collapse" id="collapse_gender">
					<p class="rojito">Debe selecionar un género (Femenino o Masculino).</p>
				</div>
				-->	
				<div class="row spaced">
					<div class="col-md-4">
						<p class="question2">Género:<span class="rojito">*</span></p>
					</div>
					<div class="col-md-7 text4">
						<label class="radio-inline"><input name="gender" type="radio" id="FEM" >Femenino</label>
						<label class="radio-inline"><input name="gender" type="radio" id="MAS" >Masculino</label>
					</div>
				</div>
				<div class="col-xs-12 collapse" id="collapse_gender">
					<p class="rojito">Debe selecionar un género.</p>
				</div>

				<!--
				<div class="row textList">
					<div class="col-xs-4">
						<p class="question2">Tipo de Identificación:<span class="rojito">*</span></p>
					</div>
					<div class="col-xs-8">
						<p><input class="form-control pull-right" id="personales5" type="text" name="Nombre" value=""></p>
					</div>
				</div>
				-->
				<div class="row textList">
					<div class="col-xs-4">
						<p class="question2">DNI:<span class="rojito">*</span></p>
					</div>
					<div class="col-xs-8">
						<p><input class="form-control pull-right" id="DNI" type="text" name="Nombre" value=""></p>
					</div>
				</div>
				<div class="col-xs-12 collapse" id="collapse_DNI">
					<p class="rojito">El DNI debe contener '.' (puntos) o no en un DNI válido.</p>
				</div>
				
				<div class="row">
					<div class="col-xs-6">
			
							<button type="button" class="btn btn-sm btn-success btn-block extra" id="modificar-accept">Confirmar Cambios</button>

					</div>
					<div class="col-xs-6">			    				
							<button type="button" class="btn btn-sm btn-block btn-danger delete-order extra" id="modificar-cancel">Cancelar</button>
					</div>
				</div>
        	</div>
        </div>			
	</div>

  <!-- ___________________________________________________ -->
    <footer class="footer">
      <div class="container footer-cont">

        <div class="row">

          <div class="col-xs-6 col-sm-6 col-md-8">
            <div class="row">

              <div class="col-xs-12 col-sm-12 col-md-6"> <!---->
                <div class="row">
                  <div class="col-xs-6 col-sm-6 col-md-6 col1">
                    <div class="footer-text">
                      <p class="text-muted">
                        <b>Seguinos</b>
                      </p>
                        <ul>
                          <li><a href="http://facebook.com" target="_blank">Facebook</a></li>
                          <li><a href="http://twitter.com" target="_blank">Twitter</a></li>
                          <li><a href="http://instagram.com" target="_blank">Instagram</a></li>
                          <li><a href="https://plus.google.com" target="_blank">Google+</a></li>
                          <li><a href="https://www.youtube.com" target="_blank">Youtube</a></li>
                        </ul>
                    </div>
                  </div>
                

                  <div class="col-xs-6 col-sm-6 col-md-6 col2">
                    <div class="footer-text">
                      <p class="text-muted">
                        <b>Empresa</b>
                      </p>
                        <ul>
                          <li><a href="en_construccion.html">¿Quienes somos?</a></li>
                          <li><a href="en_construccion.html">Términos y condiciones</a></li>
                        </ul>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-xs-12 col-sm-12 col-md-6"> <!---->  
                <div class="row">
                  <div class="col-xs-6 col-sm-6 col-md-6 col3">
                     <div class="footer-text">
                      <p class="text-muted">
                        <b>Ayuda</b>
                      </p>
                        <ul>
                          <li><a href="en_construccion.html">Atención al cliente</a></li>
                          <li><a href="faq.html">Preguntas frecuentes</a></li>
                        </ul>
                    </div>
                  </div>
                  
                  <div class="col-xs-6 col-sm-6 col-md-6 col4">
                   <div class="footer-text">
                    <p class="text-muted">
                      <b></b>
                    </p>
                      <ul>
                        <li><a href="http://www.visa.com.ar/" target="_blank"></a></li>
                        <li><a href="https://www.masterconsultas.com.ar/" target="_blank"></a></li>
                        <li><a href="https://www.americanexpress.com/ar/" target="_blank"></a></li>
                        <li><a href="http://www.mastercard.com/ar/consumidores/maestro.html" target="_blank"></a></li>
                        <li><a href="http://www.cabal.coop/" target="_blank"></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          
          <div class="col-xs-6 col-sm-6 col-md-3 col-md-offset-1 -col5">
            <div class="footer-buy-button">
              <!--<p class="text-muted">-->
                <button id="howtobuy" class="btn btn-default howtobuy" type="button">
                  ¿Cómo comprar?
                </button>
              <!--</p>-->
            </div>
          </div>

        </div>

      </div>
    </footer>


<script src="index.js"></script>
<script src="API.js"></script>
<script src="validations.js"></script>
<script src="cookies.js"></script>
<script src="cart.js"></script>


<script>
	
	$( document ).ready(function() {

		///////////////////////////
	    floads();

	    if (isLogged()){
	      var fav_q = localStorage.getItem('countItem');
	      if (fav_q == null || fav_q == "null")
	        localStorage.setItem('countItem', 0);

	      $('#fav-link').append('(' + fav_q + ')');

	      getCartLength(
	        function(length){
	           $('#cart-link').append('(' + length + ')');
	        },
	        function(){
	          //KillLoader();
	        });

	    } else {
	      //KillLoader();
	    }
	    /////////////////////////////////

		/* Variables used for validation */

		var username = get_cookie('username');
		var token = get_cookie('authenticationToken');

		var flagF=0;
		var flagO=0;
		//var username;
		var lname;
		var fname;
		var gender;
		//var email;
		//var pass1;
		//var pass2;
		var DNI;
		var date;
		//var valid_username;
		var valid_lname = true;
		var valid_fname = true;
		var valid_gender = true;
		//var valid_email;
		//var valid_pass1;
		//var valid_pass2;
		var valid_DNI = true;
		var valid_date = true;

		var email;
		function getEmail(arr){
			email = arr["account"].email;
		}
		var urlEmail = "http://eiffel.itba.edu.ar/hci/service3/Account.groovy?method=GetAccount&username="+username+"&authentication_token="+token;

		APIAction(urlEmail,getEmail);

		/* Load Default Values */

		$("#fname").attr('value', getParameterByName('name'));
		$("#lname").attr('value', getParameterByName('lastname'));
		//$("#personales3").attr('value', getParameterByName('date'));
		//$("#gender").attr('value', getParameterByName('sex'));
		
		if(getParameterByName('sex') == "Masculino"){
			$("#MAS").attr('checked', 'checked');
		}
		else{
			$("#FEM").attr('checked', 'checked');
		}
			//checked = "checked";

		$("#personales5").attr('value', getParameterByName('ID'));
		$("#DNI").attr('value', getParameterByName('number'));

		var defaultDate = getParameterByName('date').split('/'); 
		var month = defaultDate[1];
		$("#default_day").text(defaultDate[0]);
		$("#default_day").append('<span class="caret"></span>');
		$("#default_month").text(convertIntToMonth(parseInt(month)-1));
		$("#default_month").append('<span class="caret"></span>');
		$("#default_year").text(defaultDate[2]);
		$("#default_year").append('<span class="caret"></span>');

		var i;
		var days;
		var years;
		for(var i = 1; i < 32; i++){
			aux = $("<li id='day" + i + "'><a>" + i + "</a></li>");
			$("#DAYS").append(aux);
		}
		for(var x = 2015; x > 1900; x--){
			aux2=$("<li><a>" + x + "</a></li>");
			$("#YEARS").append(aux2);
		}

		$(".dropdown-menu").on('click','li',function(){
			var selText = $(this).text();
			$(this).parents('.dropdown').find('.dropdown-toggle').text(selText);
			$(this).parents('.dropdown').find('.dropdown-toggle').append('<span class="caret"></span>');
		});

		/* Buttons */
		$("#fname").focusout(function(){
			valid_fname = false;
			fname = document.getElementById("fname").value;
			if(validate_Names(fname)){
				valid_fname=true;
				$("#collapse_fname").collapse('hide');
			}else{
				$("#collapse_fname").collapse('show');
			}
		});

		$("#lname").focusout(function(){
			valid_lname = false;
			lname = document.getElementById("lname").value;
			if(validate_Names(lname)){
				valid_lname=true;
				$("#collapse_lname").collapse('hide');
			}else{
				$("#collapse_lname").collapse('show');
			}
		});

		$("#DNI").focusout(function(){
			valid_DNI = false;
			DNI = document.getElementById("DNI").value;
			if(validate_DNI(DNI)){
				valid_DNI=true;
				$("#collapse_DNI").collapse('hide');
			}else{
				$("#collapse_DNI").collapse('show');
			}
		});
		/*
		$("#gender").focusout(function(){
			valid_gender = false;
			gender = document.getElementById("gender").value;
			if(gender == "Masculino" || gender=="Femenino"){
				valid_gender=true;
				$("#collapse_gender").collapse('hide');
			}else{
				$("#collapse_gender").collapse('show');
			}
		});*/

		$("#modificar-accept").on('click', function(){
			var day;
			var month;
			var year;
			var date;
			valid_date = false;
			/* HACER
		  	if(!$("#MAS").is(':checked') && !$("#FEM").is(':checked')){
		  		$("#collapse_gender").collapse('show');
		  		valid_gender=false;
		  	}else{
		  		valid_gender=true;
		  		$("#collapse_gender").collapse('hide');
		  		if($("#MAS").is(':checked')){
		  			gender="M";
		  		}else{
		  			gender="F";
		  		}
		  	}*/
		  	day = $("#DAYS").parents(".dropdown").find("button").text();
		  	month = $("#MONTH").parents(".dropdown").find("button").text();
		  	year = $("#YEARS").parents(".dropdown").find("button").text();
		  	
		  	var d = new Date();

		  	if(day.localeCompare("Día")==0 || month.localeCompare("Mes")==0 || year.localeCompare("Año")==0){

		  		$("#collapse_date").collapse('show');
		  		valid_date = false;
		  	}else{
		  		valid_date = true;
		  		if(d.getFullYear()-year ==15){
		  			if(d.getMonth()==convertMonth(month)){
		  				if(d.getDate()>day){
		  					valid_date = false;
		  				}
		  			}else{
		  				if(d.getMonth()>convertMonth(month)){
		  					valid_date = false;
		  				}
		  			}
		  		}else{
		  			if (d.getFullYear()-year <15) {
		  			 	valid_date=false;
		  			 }
		  		}
		  		if (!valid_date) {
		  			$("#collapse_date").find("p").text("Debe mayor de 16 años para estar registrado.");
		  			$("#collapse_date").collapse('show');

		  		}else{
		  			$("#collapse_date").collapse('hide');
		  			date = year+"-"+convertMonth(month)+"-"+day;
		  		}
		  	}



		  	if(valid_fname && valid_lname && valid_gender && valid_date && valid_DNI && valid_gender){

				username = get_cookie('username');
				token = get_cookie('authenticationToken');
				
				var name = $("#fname").val();
				var lastname = $("#lname").val();
				
				//var bdate = $("#personales3").val().split("/");
				day = $("#DAYS").parents(".dropdown").find("button").text();
		  		month = $("#MONTH").parents(".dropdown").find("button").text();
		  		month = convertMonth(month);
		  		year = $("#YEARS").parents(".dropdown").find("button").text();

				var bdate = year + "-" + month + "-" + day;
				
				var sex;
				if($("#MAS").is(':checked'))
					sex = "M";
				else
					sex = "F";
					
				var number = $("#DNI").val();
				
				var f = function(arr){
					//window.location = "profile.html?activeTab=personales";
		   		};
				
		   		var url = 'http://eiffel.itba.edu.ar/hci/service3/Account.groovy?method=UpdateAccount&username='+username+'&authentication_token='+token+'&account={"firstName":"'+name+'","lastName":"'+lastname+'","gender":"'+sex+'","identityCard":"'+number+'","email":"'+email+'","birthDate":"'+bdate+'"}';

				APIAction(url,f);		

		  	}else{
		  		$("#collapse_creat").collapse('show');
		  	}

		});
		
		$("#modificar-cancel").on('click', function(){
			window.location = "profile.html?activeTab=personales";
		});
	
	});	
</script>
</body>
</html>