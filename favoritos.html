<!DOCTYPE html>
<html>
	
<head>

<meta charset="UTF-8">

	<title>look&amp;feel </title>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<link href="favoritos.css" rel="stylesheet">
<!-- ____________________________________________________ --><link href="sticky-footer-navbar.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">

  </head>

  <body>
    
    <header id="content-top">


      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a id="logo-box" class="navbar-brand verticalLine" href="index.html"><h1>look&amp;feel</h1></a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            
            <ul class="nav navbar-nav">
              <li id="women"><a id="women-link" href="#">Mujeres</a></li>
              <li id="men"><a id="men-link" href="#" class="verticalLine">Hombres</a></li>
              <li id="girls"><a id="girls-link" href="#">Niñas</a></li>
              <li id="boys" class="verticalLine"><a id="boys-link" href="#">Niños</a></li>
              <li id="babies"><a id="babies-link" href="#">Bebés</a></li>
            </ul>

            <form class="navbar-form navbar-left" role="search">
              <div class="form-group">
                <input id="search_key" type="text" class="form-control search-bar" placeholder="Buscar un producto">
              </div>
              <button id="search" type="button" class="btn btn-default">Ir</button>
            </form>
            
            <ul class="nav navbar-nav navbar-right">
              <li><a id="register" href="register.html">Registrarse</a></li>
              <li class="verticalLine"><a id="login" href="ingresar.html">Ingresar</a></li>
              <li><a id="cart-link" href="#"><img id="cart-img" src="img/cart.png" alt="carrito"></a></li>
              <li id="fav-li"><a id="fav-link" href="#"><img id="fav-img" src="img/fav.png" alt="favoritos"></a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
  </header>

<!-- ___________________________________________ -->
    
	<div class = "container" id="CONTAINER">
			<!-- ___________________________________________ -->
    <noscript>
      <div class="alert alert-danger" role="alert">
       <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
       <span class="sr-only">Error:</span>
        Es necesario activar JavaScript para que la web funcione correctamente.
      </div>
    </noscript>
    <!-- End no js msg -->
    <!-- ___________________________________________ -->
			<!-- Title -->
			<div class = "row">				
				<div class = "col-xs-6">
					<h2 class="page-title"> Favoritos </h2>
				</div>
			</div>
			<!-- End Title -->
			<!-- Cart -->
		<div class="row border-aux" id="TO_INSERT">
			<div id="TITULOS" class ="row spaced">
				<div class="col-md-12 col-xs-12" id="MENU_PRINCIPAL">
					<!-- Cart-Header -->
					<div class="row row-eq-height" id="MENU1">
						<div class="col-xs-3  col-md-2  centered">
							<h4>Código Producto</h4>
						</div>
						<div class="col-xs-9 centered verticalLineL">
							<h4>Producto</h4>
						</div>						
					</div>	
				</div>
			</div>
			<div>
				<hr class="hr_horizontal">
			</div>
		</div>

	</div> 

	  <!-- ___________________________________________________ -->
    <footer class="footer">
      <div class="container footer-cont">

        <div class="row">

          <div class="col-xs-6 col-sm-6 col-md-8">
            <div class="row">

              <div class="col-xs-12 col-sm-12 col-md-6"> <!---->
                <div class="row">
                  <div class="col-xs-6 col-sm-6 col-md-6 col1">
                    <div class="footer-text">
                      <p class="text-muted">
                        <b>Seguinos</b>
                      </p>
                        <ul>
                          <li><a href="http://facebook.com" target="_blank">Facebook</a></li>
                          <li><a href="http://twitter.com" target="_blank">Twitter</a></li>
                          <li><a href="http://instagram.com" target="_blank">Instagram</a></li>
                          <li><a href="https://plus.google.com" target="_blank">Google+</a></li>
                          <li><a href="https://www.youtube.com" target="_blank">Youtube</a></li>
                        </ul>
                    </div>
                  </div>
                

                  <div class="col-xs-6 col-sm-6 col-md-6 col2">
                    <div class="footer-text">
                      <p class="text-muted">
                        <b>Empresa</b>
                      </p>
                        <ul>
                          <li><a href="en_construccion.html">¿Quienes somos?</a></li>
                          <li><a href="en_construccion.html">Términos y condiciones</a></li>
                        </ul>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-xs-12 col-sm-12 col-md-6"> <!---->  
                <div class="row">
                  <div class="col-xs-6 col-sm-6 col-md-6 col3">
                     <div class="footer-text">
                      <p class="text-muted">
                        <b>Ayuda</b>
                      </p>
                        <ul>
                          <li><a href="en_construccion.html">Atención al cliente</a></li>
                          <li><a href="faq.html">Preguntas frecuentes</a></li>
                        </ul>
                    </div>
                  </div>
                  
                  <div class="col-xs-6 col-sm-6 col-md-6 col4">
                   <div class="footer-text">
                    <p class="text-muted">
                      <b></b>
                    </p>
                      <ul>
                        <li><a href="http://www.visa.com.ar/" target="_blank"></a></li>
                        <li><a href="https://www.masterconsultas.com.ar/" target="_blank"></a></li>
                        <li><a href="https://www.americanexpress.com/ar/" target="_blank"></a></li>
                        <li><a href="http://www.mastercard.com/ar/consumidores/maestro.html" target="_blank"></a></li>
                        <li><a href="http://www.cabal.coop/" target="_blank"></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          
          <div class="col-xs-6 col-sm-6 col-md-3 col-md-offset-1 -col5">
            <div class="footer-buy-button">
              <!--<p class="text-muted">-->
                <button id="howtobuy" class="btn btn-default howtobuy" type="button">
                  ¿Cómo comprar?
                </button>
              <!--</p>-->
            </div>
          </div>

        </div>

      </div>
    </footer>


 <!-- ___________________________________________________ -->

	<script src="cookies.js"></script>
   	<script src="API.js"></script>
   	<script src="index.js"></script>
    <script src="cart.js"></script>
    <script src="detalle_producto.js"></script>

<script>


$(document).ready(function(){

	  ///////////////////////////
    floads();

    if (isLogged()){
      var fav_q = localStorage.getItem('countItem');
      if (fav_q == null || fav_q == "null")
        localStorage.setItem('countItem', 0);

      $('#fav-link').append('(' + fav_q + ')');

      getCartLength(
        function(length){
           $('#cart-link').append('(' + length + ')');
        },
        function(){
          KillLoader();
        });

    } else {
      KillLoader();
    }
/////////////////////////////////


	var f = function(arr){
		var myId;
		var img;
		var prod_name;
		var price;
		var a = arr["product"];
		myId = a.id;
		img = a.imageUrl[0];
		prod_name = a.name;
		price = a.price;
	
		item = $("<div class='row' id='ITEM"+myId+"'>"+
					"<div class='col-xs-3 col-md-2 centered '>"+
						"<h4>"+myId+"</h4>"+
					"</div>"+
						"<div class='col-xs-9 col-md-7 verticalLineL verticalLineR'>"+
							"<div class='row row-eq-height'>"+
								"<div class='col-xs-3'>"+
									 "<a href='detalle_producto.html?productId="+myId+"'><img src='"+img+"' alt='"+prod_name+"' class='cartImg'></a>"+
								"</div>"+
								"<div class='col-xs-6 centered'>"+
									"<ul class='noBullets' id='TITLE"+myId+"'>"+
										"<li class='page-subtitle'><a href='detalle_producto.html?productId="+myId+"'><strong>"+prod_name+"</strong></a></li>"+
									"</ul>"+
								"</div>"+
								"<div class='col-xs-3'>"+	
									"<div class='row spaced'>"+
										"<div class='col-xs-5'>"+
											"<p>Color:</p>"+
										"</div>	"+
										"<div class='col-xs-12 col-md-7'>"+
											"<div class='dropdown'>"+
											"<button class='btn btn-md btn-default dropdown-toggle' type='button' data-toggle='dropdown'>"+
											"<span class='caret'></span></button>"+
											"<ul id='COLOR"+myId+"' class='dropdown-menu'>"+		
											"</ul>"+
										"</div>"+
										"</div>"+
									"</div>"+
									"<div class='row spaced'>"+
										"<div class='col-xs-6'>	"+
											"<p>Cantidad:</p>"+
										"</div>	"+
										"<div class='col-xs-12 col-md-6'>"+
											"<div class='dropdown'>"+
												"<button class='btn btn-default dropdown-toggle cart-dropDown' type='button' data-toggle='dropdown'>"+
												"<span class='caret'></span>"+
												"</button>"+
												"<ul id='COUNT"+myId+"' class='dropdown-menu'>"+
													"<li><a>1</a></li>"+
													"<li><a>2</a></li>"+
													"<li><a>3</a></li>"+
													"<li><a>4</a></li>"+
													"<li><a>5</a></li>"+
												"</ul>"+
											"</div>"+
										"</div>"+
									"</div>"+
								"</div>"+
							"</div>"+
						"</div>"+
						"<div class='col-xs-12 col-md-3 centered'>"+
							"<ul class='noBullets'>"+
								"<li class='page-subtitle' id='PRECIO"+myId+"'> Precio Unitario: $"+price+" </li>"+
								"<li class='page-subtitle' id='PRECIOT"+myId+"'><strong>Total: $</strong></li>	"+
							"</ul>"+
							"<div class='row element-x'>"+
								"<div class='col-xs-10 col-xs-offset-1'>"+
									"<button type='button' name='XXX' class='add_cart btn btn-sm btn-block btn-primary' id='AD"+myId+"'>Agregar al Carrito</button>"+
								"</div>"+
							"</div>"+
							"<div class='row element-x'>"+
								"<div class='col-xs-10 col-xs-offset-1'>"+
									"<button type='button' name='XXX' class='detalle_prod btn btn-sm btn-block btn-primary' id='DD"+myId+"'>Detalle de Producto</button>"+
								"</div>"+
							"</div>"+
							"<div class='row element-x'>"+
								"<div class='col-xs-6 col-xs-offset-3'>"+
									"<button id='Q"+myId+"' type='button' name='Quitar' class='claseSuper btn btn-sm btn-block btn-danger'>Quitar</button>"+
								"</div>"+
							"</div>"+
						"</div>"+
					"</div>"+
					"<hr id='H"+myId+"' class='my_hr_horizontal'>"+
				"</div>");
		
		(function() {
			
			var gid = myId;
			$('.claseSuper').on('click', function(){
				var x = $(this).attr("id");
				var idProd = x.substring(1);
				$("#H"+idProd).remove();
				$("#ITEM"+idProd).remove();
				for(var i = 0 ; i < vec_ids.length; i++){
					if(vec_ids[i].localeCompare(idProd)!=0){
						newids+=","+vec_ids[i];
						newcount+=","+vec_count[i];
						newcolors+=","+vec_colors[i];
						newsizes+=","+vec_sizes[i];
					}
				}
				var username = get_cookie("username");
				localStorage.setItem("ids"+username,newids);
				localStorage.setItem("count"+username,newcount);
				localStorage.setItem("colors"+username,newcolors);
				localStorage.setItem("sizes"+username,newsizes);
				countItem--;
				localStorage.setItem("countItem"+username,countItem);

			});

			$('.dropdown-menu').on('click','li',function(){
			  	var selText = $(this).text();
			  	$(this).parents('.dropdown').find('.dropdown-toggle').text(selText);
			});

			$('.detalle_prod').on('click',function(){
				alert("hola");
				var x = $(this).attr("id");
				var idProd = x.substring(2);
				window.location="detalle_producto.html?productId="+idProd;
			})

			$('.add_cart').on('click',function(){
				if($(this).hasClass("btn-primary")){
					var x = $(this).attr("id");
					var idProd = x.substring(2);
					var quantity = $("#COUNT"+idProd).parents('.dropdown').find('.dropdown-toggle').text();
					addItemToCart(idProd, quantity);
					$(this).removeClass("btn-primary");
		  			$(this).addClass("btn-success");
		  			$(this).text("Producto Agregado al Carrito");
				}else{
					window.location='cart.html';
				}
			});

		})();
			

		$("#TO_INSERT").append(item);
		
			a = a["attributes"];

			var valid_color = false;
			var valid_size = false;

			for(var w=0;w<a.length;w++){

				switch (a[w].id){
					case 4:
						for (var x = 0; x<a[w].values.length; x++) {
							$("#COLOR"+myId).append("<li class='clickeable2'>"+a[w].values[x]+"</li>");
						}
						valid_color = true;
						break;
					
					case 9:
						for (var x = 0; x<a[w].values.length; x++) {
							$("#TITLE"+myId).append("<li class='clickeable2'>"+a[w].values[x]+"</li>");
						}
						break;
					default:
						break;
				}

			}
			if(!valid_color){
				$("#COLOR"+myId).append("<li>No hay colores disponibles.</li>");
			}
			var prod_counter = localStorage.getItem("current_value_counter");
			var total_prod = localStorage.getItem("total_items");

			if(prod_counter==total_prod){
				localStorage.setItem("flag","true");
			}
			


			if(myId==61){
				$("#ITEM"+myId).remove();
				$("#H"+myId).remove();
			}else{
				$("#COLOR"+myId).parents('.dropdown').find('.dropdown-toggle').text(localStorage.getItem("current_color"+myId));
				//$("#TALLE"+myId).parents('.dropdown').find('.dropdown-toggle').text(localStorage.getItem("current_size"+myId));
				$("#COUNT"+myId).parents('.dropdown').find('.dropdown-toggle').text(localStorage.getItem("current_count"+myId));
			}
		

	}	

	var username =	get_cookie('username');
	var vec_ids;
	var vec_sizes;
	var vec_count;
	var vec_colors;
	var newids;
	var newsizes;
	var newcolors;
	var newcount;
	var countItem;
	var newCountItem;
	var current_counter;
	var flag = false;
	
	countItem = localStorage.getItem("countItem"+username);
	if(countItem == null || countItem == "null"){
	
		localStorage.setItem("countItem"+username,"1");
		localStorage.setItem("ids"+username,"0");
		localStorage.setItem("sizes"+username,"0");
		localStorage.setItem("count"+username,"0");
		localStorage.setItem("colors"+username,"0");	
	}
	countItem = localStorage.getItem("countItem"+username);
	var ids = localStorage.getItem("ids"+username);
	var sizes = localStorage.getItem("sizes"+username);
	var count = localStorage.getItem("count"+username);
	var colors = localStorage.getItem("colors"+username);
	var addprod=localStorage.getItem("addItems"+username);
	console.log(addprod);
	newCountItem = parseInt(countItem);
	console.log(newCountItem);
	if(addprod!= null && addprod != "null"){
		var toAdd = localStorage.getItem("addItems"+username).split(':');
		
		for(var i = 0; i<toAdd.length; i++){
			newCountItem++;
			ids = ids+','+toAdd[i].split(',')[0];
			sizes = sizes+','+toAdd[i].split(',')[1];
			count = count+','+toAdd[i].split(',')[2];
			colors = colors+','+toAdd[i].split(',')[3];
		}
	}
	localStorage.setItem("addItems"+username,"null");
	console.log(vec_ids, ids);
	vec_ids = ids.split(',');
	vec_sizes = sizes.split(',');
	vec_count = count.split(',');
	vec_colors = colors.split(',');
	localStorage.setItem("total_items", newCountItem);
	if(newCountItem>1){
		for(i=1;i<newCountItem;i++){
		localStorage.setItem("current_value_counter"+vec_ids[i],i+1);
		localStorage.setItem("current_size"+vec_ids[i],vec_sizes[i]);
		localStorage.setItem("current_color"+vec_ids[i],vec_colors[i]);
		localStorage.setItem("current_count"+vec_ids[i], vec_count[i]);

		var url = "http://eiffel.itba.edu.ar/hci/service3/Catalog.groovy?method=GetProductById&id="+vec_ids[i];
		APIAction(url,f);	
		}
	}else{
		localStorage.setItem("flag","true");
	}
	

	waitman();

	if(newCountItem==1){
		$("#MENU_PRINCIPAL").remove();
		aux=$('<h4>No hay productos agregados a favoritos.</h4>');
		$("#TITULOS").append(aux);
	}

	var aux = localStorage.getItem("flag");
	function waitman(){
		if (aux=="null"){
			window.setTimeout(waitman,1000);
		}else{
			var url="http://eiffel.itba.edu.ar/hci/service3/Catalog.groovy?method=GetProductById&id=61";
			APIAction(url,f);
			
		}	
	}

	$(".dropdown-menu").on('click','li',function(){
	  var selText = $(this).text();
	  $(this).parents('.dropdown').find('.dropdown-toggle').text(selText);
	 });

	

			
});



	

</script>
</body>		
</html>		